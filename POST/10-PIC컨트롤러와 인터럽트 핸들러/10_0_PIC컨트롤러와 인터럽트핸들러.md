# PIC 컨트롤러와 인터럽트 핸들러를 이용한 

# 인터럽트 처리

## PIC 컨트롤러란?

PIC 컨트롤러는 *Programmable Interrupt Controller* 의 약자로 인터럽트 처리에 관련된 세부 기능을 프로그래밍 할 수 있는 컨트롤러이다.

> PIC 컨트롤러는 옜날부터 PC 디바이스(키보드, 마우스 등)의 인터럽트를 관리해왔으며, 지금도 사용된다.

PIC 컨트롤러는 1개당 인터럽트 입력 8개를 처리할 수 있으며,<br>PC는 PIC 컨트롤러 2개를 마스터-슬레이브(*Master - Slave*) 방식으로 연결하여 최대 15개의 인터럽트를 처리한다.

> 16개가 아닌 이유는 마스터 PIC 2번 핀을 슬레이브 PIC 컨트롤러와 연결하는 데 사용하기 때문이다.

마스터 PIC 컨트롤러와 슬레이브 PIC 컨트롤러의 순으로 인터럽트 핀 번호를 IRQ(*Interrupt Request*) 번호라고 부르며, IRQ 0부터 IRQ 15 까지 16개가 할당되어 있다.

< PIC 컨트롤러의 구성과 IRQ의 관계 >

[![image](https://user-images.githubusercontent.com/34773827/60242366-8310cc80-98f0-11e9-87d8-67b4c40a9823.png)](https://user-images.githubusercontent.com/34773827/60242366-8310cc80-98f0-11e9-87d8-67b4c40a9823.png)

<hr>



## PIC 컨트롤러의 구조와 동작 방식

PIC  컨트롤러는 내부에 8비트 크기의 IRR, ISR, IMR 레지스터가 있다.

레지스터의 각 비트는 PIC 컨트롤러에 연결된 8개의 인터럽트 핀에 대한 정보를 나타내며,<br>각 레지스터의 역할은 다음과 같다.

- **IRR(*Interrupt Request Register*)**

  레지스터는 외부 디바이스와 연결된 인터럽트 핀 중에서 인터럽트가 발생한 핀의 정보를 관리한다.<br>외부 디바이스가 인터럽트를 발생시키면 PIC 컨트롤러는 IRR 레지스터에 해당 비트를 1로 설정하여 인터럽트 발생 여부를 저장한다.

- **ISR(*In-Service Register*)** 

  레지스터는 현재 인터럽트 핸들러가 실행 중인 인터럽트의 정보를 나타낸다.<br>PIC 컨트롤러는 특별한 옵션을 사용하지 않는 한 IRQ 0에 가까울수록 우선 순위를 높게 설정하므로 ISR 레지스터에 설정된 비트는 IRR 레지스터에 설정된 비트 중에서 비트 0에 가까운 비트와 같다.

- **IMR(*Interrupt Mask Register*)**

  레지스터는 비트가 1로 설정된 인터럽트 핀에서 발생한 인터럽트 요청을 무시하는 역할을 한다.<br>특정 디바이스의 인터럽트 신호를 무시하고 싶다면 IMR 레지스터의 해당 비트를 1로 설정하면 된다.

<hr>

PIC 컨트롤러와 프로세서는 INT 핀과 /INTA 핀으로 연결되어 있으며,<br>인터럽트 발생 여부와 처리 여부를 서로 알려준다.

PIC 컨트롤러의 INT 핀은 프로세서의 INTR 핀과 직접 연결되어 있으며,<br>인터럽트가 발생했을 때 INT 핀에 신호를 발생시켜 프로세서가 인터럽트를 처리하게 한다.

> /INTA 핀은 인터럽트가 프로세서에 잘 전달되었음을 PIC 컨트롤러에 알려주는 핀이다.

이처럼 프로세서와 PIC 컨트롤러는 INT와 /INTA 핀으로 서로에게 신호를 보내 인터럽트를 처리한다.

< INT 핀, /INTA 핀, 데이터 핀으로 프로세서와 PIC 컨트롤러가 인터럽트를 처리하는 과정 >

1. PIC 컨트롤러에 인터럽트 요청이 수신되고, PIC 컨트롤러는 IRR 레지스터의 해당 비트를 1로 설정한다.
2. PIC 컨트롤러는 INT 핀으로 신호를 송신하여 프로세서에 인터럽트가 발생했음을 알린다.
3. 프로세서는 /INTA 핀으로 신호를 송신하여 인터럽트 요청이 정상적으로 수신 되었음을 PIC 컨트롤러에 알린다.
4. PIC 컨트롤러는 IRR 레지스터에 가장 우선순위가 높은 것을 찾아 삭제한 뒤 ISR 레지스터의 해당 비트에 1로 설정. 그후 인터럽트 벡터의 번호를 프로세서에 전송한다.
5. 프로세서는 인터럽트 처리 완료 후 EOI 커맨드를 PIC 컨트롤러에 전송하고, PIC 컨트롤러는 ISR 레지스터에 설정된 비트를 삭제한다.
6. 인터럽트 완료 후 IRR 레지스터를 확인하여 처리되지 않은 인터럽트 요청이 있다면 2 ~ 5의 과정을 반복한다.

