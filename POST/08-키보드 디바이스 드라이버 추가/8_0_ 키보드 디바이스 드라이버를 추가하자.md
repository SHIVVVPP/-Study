# 키보드 드바이스 드라이버를 추가하자

키보드 컨트롤러와 키보드 디바이스를 제어하는 방법에 대해 살펴보고,<br>스캔 코드를 ASCII 코드로 변환하여 화면에 출력하는 셸을 구현한다.

<hr>

## 키보드 컨트롤러의 구조와 기능

### 키보드 컨트롤러, I/O 포트, 레지스터

키보드 컨트롤러는 PC 내부 버스(BUS)와 포트 I/O 방식으로 연결되어 있으며,<br>포트 어드레스는 0x60와 0x64를 사용한다.

실제로 할당된 포트는 두 개지만 포트에서 데이터를 읽을 때와 쓸 때 접근하는 레지스터가 다르므로,<br>실제로는 네 개의 레지스터와 연결된 것과 같다.

<hr>

다음은 PC 내부 버스와 키보드 컨트롤러, 키보드와 마우스의 연결을 나타낸 것이다.

![image](https://user-images.githubusercontent.com/34773827/61141499-b0709380-a508-11e9-9665-b02378468f77.png)

<hr>

다음은 읽기와 쓰기를 수행할 때 각 포트로 접근 가능한 키보드 컨트롤러의 내부 레지스터를 나타낸 것이다.

![image](https://user-images.githubusercontent.com/34773827/61141800-57552f80-a509-11e9-81bc-fbcd932a0480.png)

키보드 레지스터는 컨트롤 레지스터, 상태 레지스터, 입력 버퍼, 출력 버퍼 네 개가 있으며 크기는 모두 1바이트다.

그중에서 상태 레지스터는 키보드 컨트롤러와 우리에게 중요한 역할을 하고 있다.

상태 레지스터는 키보드 컨트롤러의 상태를 표시하는 레지스터로<br>키보드 컨트롤러로부터 키 값을 읽거나 쓰려면 반드시 체크해야 하는 비트를 포함해야 한다.

다음은  상태 레지스터가 나타내는 비트의 의미를 정리한 것이다.

![image](https://user-images.githubusercontent.com/34773827/61142554-00e8f080-a50b-11e9-80b9-22db4f81a611.png)

<hr>

키보드 컨트롤러로 부터 키 값을 얻는 것이 목적이라면<br> 상태 레지스터(포트 0x64)를 읽어서 OUTB 비트가 1인지 검사하고<br>출력 버퍼 레지스터(포트 0x60)를 읽는 것으로 충분하다.

하지만,<br>키보드 컨트롤러를 통해 키보드와 마우스를 제어해야 하므로 키보드 컨트롤러의 커맨드에 대해서 알아야한다.

![image](https://user-images.githubusercontent.com/34773827/61143051-27f3f200-a50c-11e9-9c0d-f17d1292c3f0.png)

